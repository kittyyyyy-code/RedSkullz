<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Library Kitty: Ren Morikawa Story</title>
<style>
  body {
    margin:0;
    font-family: Georgia, serif;
    background:#fdf6e3;
    color:#333;
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:20px;
  }
  h1,h2 {margin:10px 0;}
  input, textarea {
    width:90%;
    max-width:700px;
    padding:10px;
    margin:5px 0;
    border:1px solid #ccc;
    border-radius:5px;
  }
  button {
    padding:10px 20px;
    margin:5px;
    font-weight:bold;
    border:none;
    border-radius:5px;
    cursor:pointer;
    background:#222;
    color:white;
  }
  button:hover {background:#555;}
  .book-container {
    width:90%;
    max-width:700px;
    height:400px;
    border:3px solid #333;
    border-radius:10px;
    background:white;
    box-shadow:0 0 20px rgba(0,0,0,0.3);
    overflow:hidden;
    position:relative;
    margin-top:20px;
    touch-action: pan-y;
  }
  .page {
    width:100%;
    height:100%;
    padding:20px;
    box-sizing:border-box;
    position:absolute;
    top:0;
    left:0;
    transition: transform 0.5s ease;
    overflow-y:auto;
    font-size:1.1em;
    line-height:1.6em;
  }
  .page p {margin-bottom:1em;}
  .page-number {
    position:absolute;
    bottom:10px;
    right:20px;
    font-size:0.9em;
    color:#666;
  }
  .nav-btn {
    position:absolute;
    top:50%;
    transform:translateY(-50%);
    font-size:2em;
    background:rgba(0,0,0,0.1);
    border:none;
    cursor:pointer;
    width:40px;
    height:60px;
    z-index:10;
  }
  .prev-btn {left:0;}
  .next-btn {right:0;}
  #chaptersList {
    width:90%;
    max-width:700px;
    margin-top:10px;
  }
  .chapter-entry {
    border:1px solid #333;
    padding:10px;
    margin:5px 0;
    border-radius:5px;
    background:#eee;
    cursor:pointer;
  }
</style>
</head>
<body>

<h1>Library Kitty</h1>
<h2>Write a Chapter</h2>
<textarea id="chapterInput" placeholder="Write your chapter here..."></textarea>
<button onclick="addChapter()">Add Chapter</button>

<h2>Chapters</h2>
<div id="chaptersList"></div>

<h2>Book Reader</h2>
<div class="book-container" id="bookContainer">
  <button class="nav-btn prev-btn" id="prevBtn">&#8249;</button>
  <button class="nav-btn next-btn" id="nextBtn">&#8250;</button>
</div>

<script>
let chapters = JSON.parse(localStorage.getItem('libraryKittyChapters')) || [];
let currentChapterIndex = 0;
let currentPageIndex = 0;
let pages = [];

function splitIntoPages(text, charsPerPage=300){
  const pages=[];
  let start=0;
  while(start<text.length){
    pages.push(text.slice(start,start+charsPerPage));
    start+=charsPerPage;
  }
  return pages;
}

function renderChaptersList(){
  const list = document.getElementById('chaptersList');
  list.innerHTML='';
  chapters.forEach((chapter,idx)=>{
    const div=document.createElement('div');
    div.className='chapter-entry';
    div.textContent = `Chapter ${idx+1}: ${chapter.slice(0,30)}...`;
    div.onclick = ()=>{openChapter(idx);}
    list.appendChild(div);
  });
}

function addChapter(){
  const text=document.getElementById('chapterInput').value.trim();
  if(!text){ alert("Write something first!"); return; }
  chapters.push(text);
  localStorage.setItem('libraryKittyChapters', JSON.stringify(chapters));
  document.getElementById('chapterInput').value='';
  renderChaptersList();
  openChapter(chapters.length-1);
}

function openChapter(idx){
  currentChapterIndex=idx;
  currentPageIndex=0;
  pages=splitIntoPages(chapters[idx]);
  renderPage();
}

const bookContainer = document.getElementById('bookContainer');

function renderPage(){
  bookContainer.querySelectorAll('.page').forEach(p=>p.remove());
  const pageDiv=document.createElement('div');
  pageDiv.className='page';
  pageDiv.innerHTML=`<p>${pages[currentPageIndex].replace(/\n/g,'<br>')}</p>
  <div class="page-number">${currentPageIndex+1} / ${pages.length} (Chapter ${currentChapterIndex+1})</div>`;
  bookContainer.appendChild(pageDiv);
}

// Navigation buttons
document.getElementById('prevBtn').addEventListener('click', ()=>{
  if(currentPageIndex>0) currentPageIndex--;
  renderPage();
});
document.getElementById('nextBtn').addEventListener('click', ()=>{
  if(currentPageIndex<pages.length-1) currentPageIndex++;
  renderPage();
});

// Touch swipe
let touchStartX=0;
bookContainer.addEventListener('touchstart', e=>{touchStartX=e.changedTouches[0].screenX;});
bookContainer.addEventListener('touchend', e=>{
  const touchEndX = e.changedTouches[0].screenX;
  if(touchStartX-touchEndX>50){
    if(currentPageIndex<pages.length-1) currentPageIndex++;
  } else if(touchEndX-touchStartX>50){
    if(currentPageIndex>0) currentPageIndex--;
  }
  renderPage();
});

renderChaptersList();
if(chapters.length>0) openChapter(0);
</script>

</body>
</html>
